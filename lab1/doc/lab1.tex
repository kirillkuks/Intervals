\documentclass[a4paper,12pt]{article}

\usepackage[hidelinks]{hyperref}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{shorttoc}
\usepackage{cmap}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english, russian]{babel}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{float}
\graphicspath{{./img/}}

\definecolor{linkcolor}{HTML}{000000}
\definecolor{urlcolor}{HTML}{0085FF}
\hypersetup{pdfstartview=FitH,  linkcolor=linkcolor,urlcolor=urlcolor, colorlinks=true}

\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}

\renewcommand*\contentsname{Содержание}

\newcommand{\plot}[3]{
    \begin{figure}[H]
        \begin{center}
            \includegraphics[scale=0.6]{#1}
            \caption{#2}
            \label{#3}
        \end{center}
    \end{figure}
}

\begin{document}
    \include{title}
    \newpage

    \tableofcontents
    \listoffigures
    \newpage

    \section{Постановка задачи}
    \quad Имеется две вещественные выборки $ \overline{X_{1}}, \overline{X_{2}} $.
    Необходимо построить из них две интервальные выборки $ X_{1}, X_{2} $
    и найти такой вещественный коэффициент $ R $, что выборка $ X_{1} \cup R X_{2} $
    будет наиболее совместной в смысле индекса Жаккара.

    \section{Теория}
    \subsection{Индекс Жаккара}
    \quad Индекс Жаккара определяет степень совместности двух интервалов $ x, y $.
    \begin{equation}
        JK(x, y) = \frac{wid(x \land y)}{wid(x \lor y)}
        \label{e:simplejaccard}
    \end{equation}

    Здесь $ \land, \lor $ представляют собой операции взятия минимума и максимума по включению
    в полной арифметике Каухера.
    Формула \ref{e:simplejaccard} легко может быть обобщена на случай интервальной выборки $ X = \{x_i\}_{i=1}^{n} $.
    
    \begin{equation}
        JK(X) = \frac{wid(\land_{i=1,n}x_i)}{wid(\lor_{i=1,n}x_i)}
        \label{e:jaccard}
    \end{equation}

    Видно, что $ JK(X) \in [-1, 1] $. Для удобства перенормируем значение $ JK(X) $
    так, чтобы оно было в интервале $ [0, 1] $.

    \begin{equation}
        JK(X) = \frac{1}{2} + \frac{1}{2} JK(X)
    \end{equation}

    \subsection{Нахождение оптимального значения R}
    \quad Для нахождения оптимального $ R $ необходимо сначала найти верхнюю и нижнюю границы $ \underline{R}, \overline{R} $.

    \begin{equation}
        \underline{R} = \frac{\min_{i=1,n}\underline{x_{1i}}}{\max_{i=1,n}\overline{x_{2i}}}
    \end{equation}
    \begin{equation}
        \overline{R} = \frac{\max_{i=1,n}\overline{x_{1i}}}{\min_{i=1,n}\underline{x_{2i}}}
    \end{equation}

    Затем оптимальное значение $ R $ может быть найдено методом половинного деления.

    \section{Реализация}
    \quad Весь код написан на языке Python (версии 3.7.3).
    \href{https://github.com/kirillkuks/Intervals/tree/master/lab1}{Ссылка на GitHub с исходным кодом}.

    \section{Результаты}
    \quad Данные были взяты из файлов \textsl{data/dataset1/+0\_5V/+0\_5V\_0.txt} и \textsl{data/dataset/-0\_5V/-0\_5V\_42.txt}.
    Обынтерваливание было произведено следующим образом.
    \begin{equation}
        \textbf{x}_i = [(x_i - \delta_i) - \varepsilon, (x_i - \delta_i) + \varepsilon], \varepsilon = \frac{100}{2^{14}}
    \end{equation}
    где $ x_i $ - точечное значение, $ \delta_i $ - точечная погрешность.
    Набор $ \delta_i $ получен из соответствующих файлов в \textsl{data/dataset1/ZeroLine.txt}
    
    Сначала посмотрим на исходные интервальные выборки $ X_1, X_2 $.
    \plot{_X1}{Интервальная выборка $ X_1 $}{p:x1}
    \plot{_X2}{Интервальная выборка $ X_2 $}{p:x2}

    Также построим график частоты пересечений подинтервалов для построения моды с исходными интервалами выборок.
    Сначала для $ X_1 $.
    \plot{_ModaX1Hist}{Частота пересечений подинтервалов с интервалами выборки $ X_1 $}{p:modaX1}

    Затем для $ X_2 $.
    \plot{_ModaX2Hist}{Частота пересечений подинтервалов с интервалами выборки $ X_2 $}{p:modaX2}

    Мода для выборки $ X_1 $ равна интервалу $ \mu_{X_1} = [0.4290, 0.4295] $,
    для выборки $ X_2 $ мода равно интервалу $ \mu_{X_2} = [-0.4258, -0.4257] $.

    Посчитаем индекс Жаккара обеих выборок. $ JK(X_1) = 0.511 $, $ JK(X_2) = 0.477 $.
    %Верхняя и нижняя границы $ \underline{R} = -0.975, \overline{R} = -0.953 $.
    Найдем оптимальное значение $ R $
    (для наглядности на графике \ref{p:jaccard} изображён более широкий интервал значений $ R $).
    \plot{_Jaccard}{Зависимость индекса Жаккара от значения $R$}{p:jaccard}

    Оптимальное значение $ R $ оказалось равно $ R_{opt} = -1.009 $
    Построим объединённую выборку $ X = X_1 \cup R_{opt} X_2 $.
    \plot{_X1RX2}{Объединённая выборка $ X_1 \cup R_{opt} X_2 $}{p:x1rx2}

    Индекс Жаккара полученной выборки равен $ JK(X) = 0.477 $.

    Построим график частоты пересечений подинтервалов с объединённой выборкой
    $ X_1 \cup R_{opt} X_2 $.
    \plot{_ModaX1RX2Hist}{Частота пересечений подинтервалов с интервалами выборки $ X_1 \cup R_{opt} X_2 $}{p:moadX2RX2}

    Мода для объединённой выборки $ X_1 \cup R_{opt} X_2 $ равна интервалу $ \mu_{X_1 \cup R_{opt} X_2} = [0.4281, 0.4289] $.

    Посмотрим на зависимость частоты пересечений моды $ \mu(R) $ с интервалами
    для объединённой выборки $ X_1 \cup R X_2 $ в зависимости от значений $ R $.
    \plot{_ModaR}{Зависимость частоты пересечения моды с интервалами $ X_1 \cup R X_2 $}{p:modaR}

    Найдём внутреннюю и внешнюю интервальные оценки $ \textbf{R} = [R_{in}, R_{out}] $.
    Для этого введём уровень доверия $ \alpha = 0.95 $ и найдем крайние значений $ R $,
    удовлетворяющие $ JK(R) > JK(R_{opt}) * \alpha $ для внутренней оценки
    и $ \mu(R) > \mu(R_{opt}) * \alpha $ для внешний.
    Результаты представлены на рис. \ref{p:InnerOuter}
    (график $ \mu(R) $ нормирован так, чтобы $ \max_R{\mu(R)} $ и $ \max_R{JK(R)} $ были равны).
    \plot{_InnerOuter}{Внутренняя и внешняя оценки $ R $}{p:InnerOuter} 

    В итоге получили следующие оценки: $ R_{in} = [-1.0134, -1.0034] $,
    $ R_{out} = [-1.0262, -0.9935] $. Тогда $ \textbf{R} = [[-1.0134, -1.0034], [-1.0262, -0.9935]] $.

    Сравним полученные результаты с теми, что будут без учёта $ \delta_i $.
    $ X'_k = \{[x_i - \varepsilon, x_i + \varepsilon]\}^n_{i=1}, k = 1,2 $.

    $ X'_1 $ имеют вид.
    \plot{werr_X1}{Интервальная выборка $ X'_1 $}{p:werrX1}
    \plot{werr_X2}{Интервальная выборка $ X'_2 $}{p:werrX2}
    Вычислим индекс Жаккара $ JK(X'_1) = 0.1855, JK(X'_2) = 0.2421 $.

    Зависимость индекса Жаккара от значения параметра $ R $ имеет вид.
    \plot{werr_Jaccard}{Зависимость индекса Жаккара от значения $ R $}{p:werrJaccard}

    Видно, что оптимальное значение параметра $ R $ равно $ R'_{opt} = 0.9496 $,
    что значительно отличается от первого случая. 
    Тогда объелинённая выборка $ X'_1 \cup R'_{opt} X'_2 $ имеет вид.
    \plot{werr_X1RX2}{Объединённая выборка $ X'_1 \cup R'_{opt} X'_2 $}{p:werrX1RX2}

    \section{Обсуждение}
    \quad Из полученных результатов можно заметить следующее.
    Как видно на рисунке \ref{p:jaccard} график значений индекса Жаккара
    в зависимости от параметра $ R $ имеет один локальный минимум.
    Также видно, что индекс Жаккара объединённой выборки $ X = X_1 \cup R X_2 $ для любого значения $ R $
    не превосходит значения индексов Жаккара для каждой выборки $ X_1, X_2 $ по отдельности, что вполне ожидаемо.
    Несмотря на это $ JK(X) $ не сильно отличается от значений $ JK(X_1), JK(X_2) $,
    скорее всего это связано с тем, что интервалы из $ X_1 $ и $ R X_2 $ имеют примерно одинаковую длину,
    что видно на рисунке \ref{p:x1rx2}.

    На рисунках \ref{p:jaccard}, \ref{p:modaR}, \ref{p:InnerOuter} видно,
    что индекс Жаккара имеет более "острый" график в окрестности максимума
    нежели график максимального пересечения моды.
    Как следствие, для одинакового достаточно большого уровня доверия $ \alpha \approx 1.0 $
    индекс Жаккара даёт более точную оценку оптимального значения $ R $. 

\end{document}